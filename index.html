<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- 浏览器标签标题 -->
    <title>Agora: 生命科学每日研究进展导读</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            /* 优先使用 Noto Sans SC (思源黑体) 处理中文, Inter 处理英文 */
            font-family: 'Inter', 'Noto Sans SC', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* 自定义 Tailwind 配置 */
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        /* "科技感" 配色方案 */
                        'agora-dark': '#0f172a',     /* 深蓝黑 (主背景) */
                        'agora-surface': '#1e293b', /* 蓝灰 (卡片/侧边栏) */
                        'agora-border': '#334155',  /* 边框灰 */
                        'agora-primary': '#38bdf8', /* 亮蓝 (主色) */
                        'agora-hover': '#7dd3fc',   /* 亮蓝悬停 */
                        'agora-text': '#e2e8f0',    /* 亮灰 (主文字) */
                        'agora-subtext': '#94a3b8', /* 暗灰 (次要文字) */
                    },
                    fontFamily: {
                        sans: ['Inter', 'Noto Sans SC', 'sans-serif'],
                    },
                    /* 毛玻璃效果 */
                    backdropBlur: {
                        'xl': '24px',
                    }
                }
            }
        }

        /* 滚动条美化 (科技感) */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1e293b; /* agora-surface */
        }
        ::-webkit-scrollbar-thumb {
            background-color: #334155; /* agora-border */
            border-radius: 20px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background-color: #475569;
        }
    </style>
</head>

<body class="bg-agora-dark text-agora-text">

    <!-- 
      移动端导航栏 (顶部固定)
    -->
    <nav id="mobile-nav" class="md:hidden sticky top-0 z-40 flex items-center justify-between p-4 bg-agora-surface/80 backdrop-blur-xl border-b border-agora-border">
        <!-- 移动端 Logo -->
        <div class="flex items-center gap-2">
            <svg id="mobile-home-logo" class="w-8 h-8 text-agora-primary cursor-pointer" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 12.75l-2.25 2.25a1.125 1.125 0 000 1.591l2.25 2.25a1.125 1.125 0 001.591 0l2.25-2.25a1.125 1.125 0 000-1.591l-2.25-2.25a1.125 1.125 0 00-1.591 0zM11.25 12.75l-2.25 2.25a1.125 1.125 0 000 1.591l2.25 2.25a1.125 1.125 0 001.591 0l2.25-2.25a1.125 1.125 0 000-1.591l-2.25-2.25a1.125 1.125 0 00-1.591 0zM18.75 12.75l-2.25 2.25a1.125 1.125 0 000 1.591l2.25 2.25a1.125 1.125 0 001.591 0l2.25-2.25a1.125 1.125 0 000-1.591l-2.25-2.25a1.125 1.125 0 00-1.591 0zM11.25 3.75l-2.25 2.25a1.125 1.125 0 000 1.591l2.25 2.25a1.125 1.125 0 001.591 0l2.25-2.25a1.125 1.125 0 000-1.591l-2.25-2.25a1.125 1.125 0 00-1.591 0z" />
            </svg>
            <span class="text-xl font-bold text-white">AGORA</span>
        </div>
        <!-- 移动端下拉菜单 -->
        <select id="mobile-menu" class="bg-agora-surface border border-agora-border text-agora-text text-sm rounded-lg focus:ring-agora-primary focus:border-agora-primary block w-1/2 p-2.5">
            <!-- 选项将由 JS 动态填充 -->
        </select>
    </nav>

    <!-- 
      电脑端侧边栏 (左侧固定)
    -->
    <aside id="desktop-sidebar" class="hidden md:flex md:flex-col md:fixed md:inset-y-0 md:z-40 md:w-64 bg-agora-surface border-r border-agora-border">
        <!-- Logo -->
        <div class="flex items-center justify-center gap-3 p-6 border-b border-agora-border cursor-pointer" id="desktop-home-logo">
            <svg class="w-10 h-10 text-agora-primary" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 12.75l-2.25 2.25a1.125 1.125 0 000 1.591l2.25 2.25a1.125 1.125 0 001.591 0l2.25-2.25a1.125 1.125 0 000-1.591l-2.25-2.25a1.125 1.125 0 00-1.591 0zM11.25 12.75l-2.25 2.25a1.125 1.125 0 000 1.591l2.25 2.25a1.125 1.125 0 001.591 0l2.25-2.25a1.125 1.125 0 000-1.591l-2.25-2.25a1.125 1.125 0 00-1.591 0zM18.75 12.75l-2.25 2.25a1.125 1.125 0 000 1.591l2.25 2.25a1.125 1.125 0 001.591 0l2.25-2.25a1.125 1.125 0 000-1.591l-2.25-2.25a1.125 1.125 0 00-1.591 0zM11.25 3.75l-2.25 2.25a1.125 1.125 0 000 1.591l2.25 2.25a1.125 1.125 0 001.591 0l2.25-2.25a1.125 1.125 0 000-1.591l-2.25-2.25a1.125 1.125 0 00-1.591 0z" />
            </svg>
            <span class="text-2xl font-bold text-white">AGORA</span>
        </div>
        <!-- 导航列表 -->
        <nav id="desktop-menu" class="flex-1 overflow-y-auto p-4 space-y-2">
            <!-- 链接将由 JS 动态填充 -->
        </nav>
    </aside>

    <!-- 
      主内容区域
    -->
    <main id="main-content" class="md:ml-64 transition-all duration-300 ease-in-out">
        <!-- 内容头部 (显示当前标签) -->
        <header id="content-header" class="sticky top-0 md:top-0 z-30 p-4 md:p-8 bg-agora-dark/80 backdrop-blur-xl md:bg-agora-dark">
            <h1 id="content-title" class="text-3xl md:text-4xl font-bold text-white">
                <!-- 标题将由 JS 动态填充 -->
                Loading...
            </h1>
            <!-- 副标题 (包含日期) -->
            <p id="page-subtitle" class="text-lg text-agora-subtext mt-2">
                <!-- 副标题将由 JS 动态填充 -->
            </p>
        </header>

        <!-- 
          内容区域 (首页网格 或 文章列表) 
          *** 更新 1 ***
          增加了 pb-32 (padding-bottom: 8rem) 来为移动端浏览器底部栏创建安全空间
        -->
        <div id="content-area" class="p-4 md:p-8 pb-32">
            <!-- 加载动画 -->
            <div id="loader" class="flex justify-center items-center h-64">
                <svg class="animate-spin h-8 w-8 text-agora-primary" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
            </div>
            <!-- 内容将由 JS 动态填充 -->
        </div>
    </main>


    <!-- 
      =================================
      JavaScript 引擎 (v2.4)
      =================================
    -->
    <script>
        // --- 配置 ---
        const LATEST_DATA_URL = 'latest_data.json'; // 您的 JSON 文件名

        // --- 全局变量 ---
        let ALL_DATA = {}; // 存储所有新闻数据
        let LATEST_DATE = new Date().toISOString().split('T')[0]; // 默认日期

        // --- DOM 元素 ---
        const contentTitle = document.getElementById('content-title');
        const contentArea = document.getElementById('content-area');
        const pageSubtitle = document.getElementById('page-subtitle');
        const desktopMenu = document.getElementById('desktop-menu');
        const mobileMenu = document.getElementById('mobile-menu');
        const loader = document.getElementById('loader');

        /**
         * 1. 初始化应用
         */
        async function initApp() {
            try {
                loader.style.display = 'flex';
                const response = await fetch(LATEST_DATA_URL);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                ALL_DATA = await response.json();
                
                // 自动获取最新日期
                updateLatestDate();
                
                // 渲染导航
                renderNavigation();

                // 默认显示首页
                renderHomePage();

            } catch (error) {
                console.error('Failed to load data:', error);
                contentArea.innerHTML = `<p class="text-red-400">错误：无法加载数据 (latest_data.json)。<br>请确保文件已上传，并清除浏览器缓存。</p>`;
            } finally {
                loader.style.display = 'none';
            }
        }

        /**
         * 2. 渲染导航菜单 (桌面和移动)
         */
        function renderNavigation() {
            // 按字母顺序排序标签
            const labels = Object.keys(ALL_DATA).sort();

            // 桌面侧边栏
            desktopMenu.innerHTML = ''; // 清空
            labels.forEach(label => {
                const link = document.createElement('a');
                link.href = '#';
                link.textContent = label;
                link.className = 'nav-link block text-agora-text hover:text-white hover:bg-agora-border rounded-lg p-3 transition-colors duration-200 ease-in-out';
                link.dataset.label = label;
                desktopMenu.appendChild(link);
            });

            // 移动端下拉菜单
            mobileMenu.innerHTML = ''; // 清空
            // 添加首页选项
            const homeOption = document.createElement('option');
            homeOption.value = 'home';
            homeOption.textContent = '返回首页';
            mobileMenu.appendChild(homeOption);
            
            labels.forEach(label => {
                const option = document.createElement('option');
                option.value = label;
                option.textContent = label;
                mobileMenu.appendChild(option);
            });
        }

        /**
         * 3. 渲染首页 (标签网格)
         */
        function renderHomePage() {
            contentTitle.textContent = 'Agora';
            updateSubtitle('home'); // 更新副标题
            contentArea.innerHTML = ''; // 清空内容

            const labels = Object.keys(ALL_DATA).sort();
            const grid = document.createElement('div');
            grid.className = 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4';

            labels.forEach(label => {
                const card = document.createElement('a');
                card.href = '#';
                card.className = 'home-card-link block p-6 bg-agora-surface rounded-xl shadow-lg hover:shadow-2xl hover:bg-agora-border transition-all duration-300 ease-in-out transform hover:-translate-y-1';
                card.dataset.label = label;
                
                const articleCount = ALL_DATA[label].length;
                
                card.innerHTML = `
                    <h2 class="text-2xl font-bold text-white">${label}</h2>
                    <p class="text-agora-subtext mt-2">${articleCount} 篇最新研究</p>
                `;
                grid.appendChild(card);
            });

            contentArea.appendChild(grid);
            window.scrollTo(0, 0); // 滚动到顶部
        }

        /**
         * 4. 渲染选定标签的文章列表
         */
        function renderContent(label) {
            if (!ALL_DATA[label]) {
                console.error(`Label not found: ${label}`);
                renderHomePage(); // 如果标签不存在，返回首页
                return;
            }

            const articles = ALL_DATA[label];
            contentTitle.textContent = label;
            updateSubtitle('content'); // 更新副标题
            contentArea.innerHTML = ''; // 清空内容

            const articleList = document.createElement('div');
            articleList.className = 'space-y-6';

            articles.forEach((article, index) => {
                // *** 更新 2 & 3 ***
                // 1. 交换了英文 (h3) 和中文 (p) 的位置和样式。
                // 2. 删除了显示 labels 的 <div>。
                const articleCardTemplate = `
                    <a href="${article.link}" target="_blank" rel="noopener noreferrer" 
                       class="article-card block bg-agora-surface rounded-xl shadow-lg overflow-hidden
                              hover:shadow-2xl hover:border-agora-primary border-2 border-transparent 
                              transition-all duration-300 ease-in-out transform hover:-translate-y-1 group"
                       style="animation-delay: ${index * 50}ms; opacity: 0; animation: fadeIn 0.5s ease-out forwards;">
                        
                        <div class="p-5">
                            <!-- 期刊 | 日期 -->
                            <span class="text-agora-subtext text-sm font-medium">
                                ${article.journal} | ${article.published_display}
                            </span>
                            
                            <!-- 英文标题 (主) -->
                            <h3 class="mt-2 text-xl font-semibold text-white group-hover:text-agora-primary transition-colors duration-200 ease-in-out">
                                ${article.title}
                            </h3>
                            
                            <!-- 中文标题 (副) -->
                            <p class="mt-1 text-lg font-medium text-blue-300">
                                ${article.title_cn}
                            </p>

                            <!-- 摘要 -->
                            <p class="mt-3 text-agora-subtext text-base leading-relaxed">
                                ${article.abstract_cn.substring(0, 250)}...
                            </p>
                            
                            <!-- (已删除) 标签区域 -->

                        </div>
                    </a>
                `;
                articleList.innerHTML += articleCardTemplate;
            });

            contentArea.appendChild(articleList);
            window.scrollTo(0, 0); // 滚动到顶部
        }

        /**
         * 5. 更新副标题 (包含日期)
         */
        function updateSubtitle(pageType) {
            const subtitleBase = "Agora: 生命科学每日研究进展导读";
            const dateString = LATEST_DATE;
            
            if (pageType === 'home') {
                pageSubtitle.textContent = `${subtitleBase} | ${dateString}`;
            } else {
                pageSubtitle.textContent = `${subtitleBase} | ${dateString}`;
            }
        }
        
        /**
         * 6. 从数据中提取最新日期
         */
         function updateLatestDate() {
            try {
                // 尝试从第一个标签的第一篇文章获取日期
                const firstLabel = Object.keys(ALL_DATA)[0];
                const firstArticle = ALL_DATA[firstLabel][0];
                if (firstArticle && firstArticle.published_display) {
                    LATEST_DATE = firstArticle.published_display;
                }
            } catch (e) {
                // 如果失败，LATEST_DATE 保持为今天的日期
                console.warn("Could not parse date from data, using system date.");
            }
         }

        /**
         * 7. 事件监听器
         */

        // 桌面侧边栏点击
        desktopMenu.addEventListener('click', (e) => {
            e.preventDefault();
            if (e.target.classList.contains('nav-link')) {
                const label = e.target.dataset.label;
                renderContent(label);
                
                // 更新活动状态
                document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('bg-agora-border', 'text-white'));
                e.target.classList.add('bg-agora-border', 'text-white');
            }
        });

        // 移动端下拉菜单更改
        mobileMenu.addEventListener('change', (e) => {
            const value = e.target.value;
            if (value === 'home') {
                renderHomePage();
            } else {
                renderContent(value);
            }
        });
        
        // Logo 点击返回首页
        document.getElementById('desktop-home-logo').addEventListener('click', renderHomePage);
        document.getElementById('mobile-home-logo').addEventListener('click', renderHomePage);
        
        // 首页卡片点击
        contentArea.addEventListener('click', (e) => {
            const card = e.target.closest('.home-card-link');
            if (card) {
                e.preventDefault();
                const label = card.dataset.label;
                renderContent(label);
                // 更新移动端下拉菜单的显示
                mobileMenu.value = label;
                // 更新桌面端菜单的活动状态
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.remove('bg-agora-border', 'text-white');
                    if (link.dataset.label === label) {
                        link.classList.add('bg-agora-border', 'text-white');
                    }
                });
            }
        });

        // --- CSS 动画 ---
        // 动态注入 CSS 动画
        const styleSheet = document.createElement("style");
        styleSheet.type = "text/css";
        styleSheet.innerText = `
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(10px); }
                to { opacity: 1; transform: translateY(0); }
            }
            .article-card { animation-fill-mode: forwards; }
        `;
        document.head.appendChild(styleSheet);

        // --- 启动应用 ---
        initApp();
    </script>

</body>
</html>